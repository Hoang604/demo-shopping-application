<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User Information</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            text-align: center;
            padding: 50px;
        }
        .container {
            border: 1px solid #dee2e6;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            display: inline-block;
            width: 80%;
            margin: auto;
        }
        h1 {
            font-size: 2em;
        }
        .details {
            text-align: left;
            margin-top: 20px;
        }
        .details label {
            font-weight: bold;
        }
        .details div {
            margin-bottom: 10px;
        }
        .buttons {
            margin-top: 20px;
        }
        .buttons button {
            margin-right: 10px;
        }
        .back-button, .logout-button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            text-decoration: none;
        }
        .back-button:hover, .logout-button:hover {
            background-color: #555;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Hiển thị popup nếu có thông báo
        document.addEventListener('DOMContentLoaded', function() {
            var message = /*[[${message}]]*/ 'null';
            if (message !== 'null') {
                Swal.fire({
                    title: 'Success',
                    text: message,
                    icon: 'success',
                    confirmButtonText: 'OK'
                });
            }
        });

        function updateUser(userId) {
            var form = document.getElementById('updateForm');
            var formData = new FormData(form);
            fetch('/users/' + userId, {
                method: 'PUT',
                body: JSON.stringify(Object.fromEntries(formData)),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => {
                if (response.ok) {
                    Swal.fire({
                        icon: 'success',
                        title: 'User updated successfully.',
                        showConfirmButton: false,
                        timer: 2000
                    }).then(() => {
                        window.location.href = "/api/users";
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Failed to update user.',
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
            }).catch(error => {
                console.error('Error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Failed to update user.',
                    showConfirmButton: false,
                    timer: 2000
                });
            });
        }

        function deleteUser(userId) {
            fetch('/users/' + userId, {
                method: 'POST'
            }).then(response => {
                if (response.ok) {
                    Swal.fire({
                        title: 'Success',
                        text: 'User deleted successfully',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        window.location.href = '/users';
                    });
                } else {
                    Swal.fire({
                        title: 'Error',
                        text: 'Failed to delete user',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const logoutButton = document.querySelector('a[href="/logout"]');
            if (logoutButton) {
                logoutButton.addEventListener('click', function(event) {
                    event.preventDefault();
                    Swal.fire({
                        title: 'Are you sure you want to logout?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Yes, logout',
                        cancelButtonText: 'Cancel'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = '/logout';
                        }
                    });
                });
            }
        });
    </script>
</head>
<body>
    <header>
        <h1>User Information</h1>
    </header>
    <main>
        <div class="user-details">
            <form id="updateForm">
                <label>ID:</label>
                <p th:text="${user.id}">1</p>

                <label>Username:</label>
                <input type="text" name="username" th:value="${user.username}" required>

                <label>Password:</label>
                <input type="password" name="password" th:value="${user.password}" required>

                <label>Phone Number:</label>
                <input type="text" name="phoneNumber" th:value="${user.phoneNumber}" required>

                <label>Role:</label>
                <input type="text" name="role" th:value="${user.role}" required>

                <div class="buttons">
                    <button type="button" th:onclick="'updateUser(' + ${user.id} + ')'">Update User</button>
                    <button type="button" th:onclick="'deleteUser(' + ${user.id} + ')'">Delete User</button>
                </div>
            </form>
            <a href="/api/users" class="back-button">&larr;</a>
            <a href="/logout" class="logout-button">Logout</a>
        </div>
    </main>
    <footer>
        <p>&copy; 2023 Shopping Application. All rights reserved.</p>
    </footer>
</body>
</html>